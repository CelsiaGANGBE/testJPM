<app-navbar></app-navbar>
<section class="vh-100 bg-image">
  <div class="d-flex justify-content-end m-2">
    <button type="button" class="btn btn-success rounded" routerLink="/add">
      Ajouter une nouvelle tâche
    </button>
  </div>

  <hr class="my-4" />

  <div class="d-flex justify-content-end align-items-center mb-4 pt-2 pb-3">
    <p class="small mb-0 me-2 text-black font-weight-bold mr-2">Filter</p>
    <select class="select mr-4" [(ngModel)]="statut" (change)="tri()">
      <option [ngValue]="'all'">Tout</option>
      <option [ngValue]="'to_do'">À faire</option>
      <option [ngValue]="'in_progress'">En cours</option>
      <option [ngValue]="'finished'">Terminer</option>
    </select>
    <p class="small mb-0 ms-4 me-2 text-black font-weight-bold mr-2">Trier</p>
    <select
      class="select"
      [(ngModel)]="date_filtered_mode"
      (change)="tri_date()"
    >
      <option value="date_creation">Date de création</option>
      <option value="date_fin">Date d'échéance</option>
    </select>
  </div>
  <div class="p-lg-2 h-100">
    <div *ngIf="tasks.length === 0">
      <h2 class="text-success text-center font-weight-bold">
        Vous n'avez pas de tâches actuellement! Ajoutez-en...
      </h2>
    </div>
    <table class="table table-striped" *ngIf="tasks">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Nom</th>
          <th scope="col">Description</th>
          <th scope="col">Statut</th>
          <th scope="col">Date de création</th>
          <th scope="col">Date d'échance</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let task of filtered_tasks; let i = index">
          <th scope="row">{{ i + 1 }}</th>
          <td>{{ task.name }}</td>
          <td>{{ task.description }}</td>
          <td class="align-middle">
            <h6
              class="mb-0 p-2"
              [ngClass]="{
                'bg-green text-green': task.statut === 'to_do',
                'bg-red text-red':
                  task.statut === 'due' || task.statut === 'in_progress'
              }"
            >
              {{
                task.statut === "to_do"
                  ? "À faire"
                  : task.statut === "in_progress"
                  ? "En cours"
                  : "Terminé"
              }}
            </h6>
          </td>

          <td scope="col">{{ formateDate(task.created_at) }}</td>
          <td scope="col">{{ task.due_date }}</td>
          <td scope="col ">
            <i
              class="fas fa-edit mr-4 text-info"
              (click)="goUpdateTask(task.id)"
            ></i>
            <i
              class="fas fa-trash-alt text-danger"
              (click)="deleteTask(task.id)"
            ></i>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<ng-template #longContent let-modal style="z-index: 1060">
  <div class="modal-header">
    <h4 class="modal-title">Création d'une nouvelle tâche</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="modal-body">
    <form>
      <div class="form-outline mb-4">
        <label class="form-label" for="name">Nom de la tâche</label>
        <input type="text" id="name" class="form-control form-control-lg" />
      </div>

      <div class="form-outline mb-4">
        <label class="form-label" for="description"
          >Description de la tâche</label
        >
        <input
          type="text"
          id="description"
          class="form-control form-control-lg"
        />
      </div>

      <div class="form-outline mb-4">
        <label class="form-label" for="date">Date d'échéance</label>
        <input type="date" id="date" class="form-control form-control-lg" />
      </div>

      <div class="d-flex justify-content-center">
        <button
          type="button"
          class="btn btn-success btn-block btn-lg gradient-custom-4 text-body"
        >
          Ajouter
        </button>
      </div>
    </form>
  </div>
</ng-template>
